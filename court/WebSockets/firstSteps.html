<!DOCTYPE HTML>
<html>
<head>
<script type="text/javascript">
var timer;

// Initialize WebSocket connection and event handlers
function setup() {
	output = document.getElementById("output");
	ws = new WebSocket("ws://echo.websocket.org/echo");

	// Check here all possible events: open, close, error, message
	ws.onopen = function(e) {
		log("Connected");
		sendMessage("Hello WebSocket");
	}

	ws.onclose = function(e) {
		log("Disconnected: " + e.reason);
	}

	ws.onerror = function(e) {
		log("Error ");
	}

	ws.onmessage = function(e) {
		log("Message received: " + e.data);
		// Close connection after message was received
		ws.close();
	}
}

function sendMessage(msg) {
	ws.send(msg);
	log("Message sent: " + msg);
}

function log(s) {
	output = document.getElementById("output");
	var p = document.createElement("p");
	p.style.wordWrap = "break-word";
	p.textContent = s;
	output.appendChild(p);
	console.log(s);
}

function startWebSocket() {
	// Endless looping setup() to get an echo each 3s
	log("Start sending messages to echo server");
	timer = setInterval(function(){setup()}, 3000);	
}

function stopWebSocket() {
	clearInterval(timer);
	log("Stopping WebSockets");
}

</script>
</head>
<body>
<button onclick="startWebSocket()">Start</button>
<button onclick="stopWebSocket()">Stop</button>
<div id="output"></div>
</body>
</html>